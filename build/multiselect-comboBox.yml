resources:
  repositories:
  - repository: self
    type: git
    ref: master

variables:
- name: Version.MajorMinorPatch
  value: 1.0.0
- name: Version.Revision
  value: $[counter(variables['Version.Revision'], 1)]
- name: BuildConfiguration
  value: release
- name: BuildPlatform
  value: any cpu

name: $(Build.DefinitionName).$(SourceBranchName)_$(Version.MajorMinorPatch).$(Version.Revision)

jobs:
- job: Phase_1
  displayName: Agent job 1
  pool:
    vmImage: windows-2019

  steps:
  - checkout: self
    clean: true

  - task: NuGetToolInstaller@1

  - task: NuGetCommand@2
    displayName: NuGet restore
    inputs:
      command: 'restore'
      restoreSolution: '**/*.sln'
      feedsToUse: 'select'
      vstsFeed: 'af66e256-9c46-4fba-ad75-09bf110ec1cc'

  - task: VSBuild@1
    displayName: 'Build solution **\*.sln'
    inputs:
      platform: $(BuildPlatform)
      configuration: $(BuildConfiguration)

  - task: NuGetCommand@2
    inputs:
      command: 'pack'
      packagesToPack: 'MultiSelectComboBox\Sdl.MultiSelectComboBox\Sdl.MultiSelectComboBox.csproj'
      versioningScheme: 'off'

  - task: PublishBuildArtifacts@1
    displayName: 'Publish Artifact: drop'

  - task: NuGetCommand@2
    displayName: 'NuGet push'
    inputs:
      command: push
      nuGetFeedType: external
      externalEndpoint: 015dcc9e-9622-43c5-b0dd-926a1a803fd4 